<html>
	<head>
		<title>SaltwashVR</title>
	</head>
	<body>

		<script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
		<script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.min.js"></script>
		<script src="https://rawcdn.githack.com/elbobo/aframe-gltf-morph-component/07e9b80bd382cc1c19223468d35c453e7c76e9a2/dist/aframe-gltf-morph-component.js"></script>

		<a-scene renderer="gammaOutput: true">
			<a-assets>
				<a-asset-item id="dude-gltf" src="/assets/dude.gltf"></a-asset-item>
				<a-asset-item id="worm1-gltf" src="/assets/worm1.gltf"></a-asset-item>
				<a-asset-item id="worm2-gltf" src="/assets/worm2.gltf"></a-asset-item>
				<a-asset-item id="worm3-gltf" src="/assets/worm3.gltf"></a-asset-item>
				<a-asset-item id="road-gltf" src="/assets/road.gltf"></a-asset-item>
			</a-assets>

			<a-entity 
			id="dude"
			gltf-model="#dude-gltf"
			position="0 0 -2.7"
			scale="4 4 4"
			animation-mixer
			sound="src: url(/assets/dude.mp3);"></a-entity>

			<a-entity 
			id="worm1"
			gltf-model="#worm1-gltf"
			position="0 0 -6.7"
			rotation="0 -90 0"
			scale="2 2 2"
			gltf-morph__squash="morphtarget:Squash;"
			animation="property:gltf-morph__squash.value; from:0; to:1; loop: true; dir: alternate;"></a-entity>

			<a-entity 
			id="worm2"
			gltf-model="#worm2-gltf"
			position="-1 0 -8.7"
			rotation="0 -90 0"
			scale="2 2 2"
			gltf-morph__squash="morphtarget:Squash;"
			animation="property:gltf-morph__squash.value; from:0; to:1; loop: true; dir: alternate; delay: 200"></a-entity>

			<a-entity 
			id="worm3"
			gltf-model="#worm3-gltf"
			position="1 0 -12.7"
			rotation="0 -90 0"
			scale="2 2 2"
			gltf-morph__squash="morphtarget:Squash;"
			animation="property:gltf-morph__squash.value; from:0; to:1; loop: true; dir: alternate; delay: 400"></a-entity>

			<a-entity 
			id="road"
			gltf-model="#road-gltf"
			position="0 0 -2.7"
			scale="2 2 2"
			animation="property: position; from: 0 0 0; to: 0 0 -800; dur: 35000;"></a-entity>

			<a-entity 
			id="punkish"
			sound="src: url(/assets/punkish.mp3); autoplay: true; positional: false; volume: 0.8;"></a-entity>

			<a-entity id="rig" position="-2 1.6 0" rotation="0 -50 0">
				<a-entity id="camera" camera look-controls></a-entity>
			</a-entity>

			<a-sky color="#19ABE5"></a-sky>
		</a-scene>

		<script>

			// enter vr
			document.querySelector('a-scene').addEventListener('enter-vr', function () {
				const rig = document.querySelector('#rig');
				rig.object3D.position.set(-2, 0.6, 1.5);
			});

			// exit vr
			document.querySelector('a-scene').addEventListener('exit-vr', function () {
				const rig = document.querySelector('#rig');
				rig.object3D.position.set(-2, 1.6, 0);
			});

			// add sound
			setTimeout(
				function() {
					const dude = document.querySelector('#dude');
					dude.components.sound.playSound();
			}, 10000);

			// road animation completed
			road.addEventListener('animationcomplete', function(){
				const dude = document.querySelector('#dude');
				dude.parentNode.removeChild(dude);

				const worm1 = document.querySelector('#worm1');
				worm1.parentNode.removeChild(worm1);

				const worm2 = document.querySelector('#worm2');
				worm2.parentNode.removeChild(worm2);

				const worm3 = document.querySelector('#worm3');
				worm3.parentNode.removeChild(worm3);

				const punkish = document.querySelector('#punkish');
				punkish.parentNode.removeChild(punkish);
			});

		</script>

	</body>
</html>